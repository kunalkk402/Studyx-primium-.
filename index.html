<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Educational Platform</title>
    <script>
      (function() {
        // Configuration
        const GATEWAY_PAGE = 'https://key-gen-cyberpunk-glow.lovable.app/';
        const HOME_PAGE = 'https://studyx-app.vercel.app/home';
        const COOLDOWN_HOURS = 24;
        const VERIFICATION_KEY = 'gateway_verified_v2';

        // Check if we should show the app (after verification)
        const urlParams = new URLSearchParams(window.location.search);
        const showApp = urlParams.get('show_app') === 'true';

        if (showApp) {
          // Set verification with expiry
          const expiryTime = Date.now() + (COOLDOWN_HOURS * 60 * 60 * 1000);
          localStorage.setItem(VERIFICATION_KEY, expiryTime.toString());
          // Remove the parameter to prevent looping
          window.history.replaceState({}, document.title, window.location.pathname);
          return; // Continue loading the app
        }

        // Check existing verification
        const storedExpiry = localStorage.getItem(VERIFICATION_KEY);
        const currentTime = Date.now();

        if (!storedExpiry || currentTime > parseInt(storedExpiry)) {
          // Not verified or expired - redirect to gateway
          if (storedExpiry) localStorage.removeItem(VERIFICATION_KEY);
          
          // Set return URL with verification parameter
          const returnUrl = encodeURIComponent(
            window.location.origin + window.location.pathname + '?show_app=true'
          );
          window.location.href = `${GATEWAY_PAGE}?return_to=${returnUrl}`;
          return;
        }

        // If verified, continue to load the app
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
