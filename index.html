<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Educational Platform</title>
    <script>
      (function() {
        // Configuration
        const ENTRY_POINT = 'https://vplink.in/nrLwIQ';
        const GATEWAY_PAGE = 'https://key-gen-cyberpunk-glow.lovable.app/';
        const HOME_PAGE = 'https://studyx-app.vercel.app/home';
        const COOLDOWN_HOURS = 24;
        
        // Check URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const fromVplink = urlParams.has('fromVplink');
        const fromGateway = urlParams.has('fromGateway');
        
        // Get stored values
        const lastAccessTime = localStorage.getItem('lastAccessTime');
        const gatewayShownTime = localStorage.getItem('gatewayShownTime');
        const currentTime = new Date().getTime();
        const cooldownPeriod = COOLDOWN_HOURS * 60 * 60 * 1000;
        
        // Process different access scenarios
        if (fromVplink) {
          // User came through entry point - set flags and proceed
          localStorage.setItem('validEntry', 'true');
          localStorage.setItem('lastAccessTime', currentTime.toString());
          
          // Show gateway page if needed
          if (!gatewayShownTime || (currentTime - gatewayShownTime > cooldownPeriod)) {
            localStorage.setItem('gatewayShownTime', currentTime.toString());
            window.location.href = GATEWAY_PAGE;
            return;
          }
        } 
        else if (fromGateway) {
          // Coming back from gateway page - redirect to home
          window.location.href = HOME_PAGE;
          return;
        }
        else {
          // Direct access attempt
          const isValidEntry = localStorage.getItem('validEntry') === 'true';
          const isWithinCooldown = gatewayShownTime && 
                                 (currentTime - gatewayShownTime <= cooldownPeriod);
          
          if (!isValidEntry) {
            // Never came through vplink - redirect to entry
            window.location.href = ENTRY_POINT;
            return;
          }
          else if (!isWithinCooldown) {
            // Cooldown expired - show gateway again
            localStorage.setItem('gatewayShownTime', currentTime.toString());
            window.location.href = GATEWAY_PAGE;
            return;
          }
        }
        
        // If all checks passed, continue loading the app
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
